<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="480" viewBox="0 0 1200 480">
  <defs>
    <style>
      .box { fill: #ffffff; stroke: #111111; stroke-width: 2; }
      .label { font-family: "Times New Roman", "DejaVu Serif", serif; font-size: 18px; fill: #111111; }
      .small { font-size: 14px; fill: #111111; }
      .muted { fill: #555555; }
      .accentText { fill: #1f5cff; }
      .arrow { stroke: #111111; fill: none; stroke-width: 2; }
      .arrowAccent { stroke: #1f5cff; fill: none; stroke-width: 2.5; }
    </style>
    <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#111111"/>
    </marker>
    <marker id="arrowHeadAccent" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#1f5cff"/>
    </marker>
  </defs>

  <text x="30" y="40" class="label">Option A (δ-TTA): inject a single trainable δ into conditioning vec</text>

  <!-- Minimal pipeline -->
  <rect x="40" y="95" width="160" height="60" class="box"/>
  <text x="55" y="125" class="label">x_cond</text>
  <text x="55" y="145" class="small muted">frames 0–32</text>

  <rect x="40" y="175" width="160" height="60" class="box"/>
  <text x="55" y="210" class="label">prompt</text>

  <rect x="230" y="95" width="170" height="60" class="box"/>
  <text x="245" y="125" class="label">VAE Encoder</text>
  <text x="245" y="145" class="small muted">FROZEN</text>

  <rect x="230" y="175" width="170" height="60" class="box"/>
  <text x="245" y="205" class="label">Text Encoder</text>
  <text x="245" y="225" class="small muted">FROZEN</text>

  <path d="M200 125 L230 125" class="arrow" marker-end="url(#arrowHead)"/>
  <path d="M200 205 L230 205" class="arrow" marker-end="url(#arrowHead)"/>

  <rect x="430" y="105" width="90" height="40" class="box"/>
  <text x="445" y="132" class="small">z_cond</text>
  <path d="M400 125 L430 125" class="arrow" marker-end="url(#arrowHead)"/>

  <rect x="430" y="185" width="90" height="40" class="box"/>
  <text x="445" y="212" class="small">c_text</text>
  <rect x="430" y="235" width="90" height="40" class="box"/>
  <text x="445" y="262" class="small">p_text</text>
  <path d="M400 205 L430 205" class="arrow" marker-end="url(#arrowHead)"/>
  <path d="M400 205 L430 255" class="arrow" marker-end="url(#arrowHead)"/>

  <!-- Sampling loop (frozen) with denoiser -->
  <rect x="540" y="85" width="430" height="210" class="box"/>
  <text x="555" y="115" class="label">Diffusion sampling loop (t = T…0)</text>
  <text x="555" y="135" class="small muted">FROZEN</text>

  <rect x="565" y="155" width="270" height="110" class="box"/>
  <text x="580" y="185" class="label">Denoiser (MMDiT)</text>
  <text x="580" y="205" class="small muted">FROZEN</text>
  <text x="580" y="235" class="small muted">vec → AdaLN modulation</text>

  <!-- vec path with δ injection -->
  <text x="860" y="210" class="small muted">vec</text>
  <circle cx="905" cy="205" r="13" fill="#ffffff" stroke="#1f5cff" stroke-width="2.5"/>
  <text x="901" y="212" class="label accentText">+</text>
  <text x="930" y="210" class="small accentText">vec' = vec + δ</text>
  <path d="M835 205 L892 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M918 205 L835 235" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>

  <rect x="860" y="155" width="110" height="50" class="box" style="stroke:#1f5cff;stroke-width:2.5"/>
  <text x="875" y="185" class="label accentText">δ</text>
  <text x="905" y="185" class="small accentText">TRAINABLE</text>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L915 205" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>
  <path d="M915 205 L905 218" class="arrowAccent" marker-end="url(#arrowHeadAccent)"/>

  <!-- outputs -->
  <rect x="860" y="235" width="90" height="40" class="box"/>
  <text x="875" y="262" class="small">v_pred</text>
  <path d="M835 235 L860 255" class="arrow" marker-end="url(#arrowHead)"/>

  <rect x="990" y="95" width="170" height="60" class="box"/>
  <text x="1005" y="125" class="label">VAE Decoder</text>
  <text x="1005" y="145" class="small muted">FROZEN</text>
  <path d="M970 255 L990 125" class="arrow" marker-end="url(#arrowHead)"/>

  <rect x="990" y="175" width="170" height="60" class="box"/>
  <text x="1005" y="205" class="label">x_out</text>
  <text x="1005" y="225" class="small muted">frames 0–64 (33–64 gen)</text>
  <path d="M1075 155 L1075 175" class="arrow" marker-end="url(#arrowHead)"/>

  <!-- TTA note -->
  <rect x="40" y="330" width="560" height="110" class="box"/>
  <text x="55" y="360" class="label">TTA (per video)</text>
  <text x="55" y="388" class="small">• optimize δ only; backbone frozen</text>
  <text x="55" y="410" class="small">• K gradient steps</text>
  <text x="55" y="432" class="small">• loss uses only frames 0–32</text>
</svg>

